---
machine:
  environment:
    DB: postgres
  services:
    - postgresql
  ruby:
    version: 2.1.5
dependencies:
  pre:
    - gem -v
    - rvm install rubygems 2.4.3 --force
    - gem install bundler -v '1.11.2'
    - sed -i -e "s/Gem.activate_bin_path('bundler', 'bundle', version)/'\/home\/ubuntu\/.rvm\/gems\/ruby-2.1.5\/gems\/bundler-1.11.2\/exe\/bundle'/g" /home/ubuntu/.rvm/gems/ruby-2.1.5/bin/bundle
    - bundle -v
  override:
    - ./build-ci.rb install
    - bundle -v
    - gem -v
test:
  override:
    - sed -i -e "s/Gem.activate_bin_path('bundler', 'bundle', version)/'\/home\/ubuntu\/.rvm\/gems\/ruby-2.1.5\/gems\/bundler-1.11.2\/exe\/bundle'/g" /home/ubuntu/.rvm/gems/ruby-2.1.5/bin/bundle
    - './build-ci.rb test':
       parallel: true
    - bundle -v
